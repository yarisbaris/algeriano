<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Algeriano_Neo â€” Ù…Ù†ØµØ© ÙÙŠØ¯ÙŠÙˆ</title>

<style>
:root{
  --bg:#05060a; --panel:#0b0f19; --muted:#9aa3b2;
  --primary:#00c2ff; --accent:#8b00ff; --glass: rgba(255,255,255,0.03);
  --text:#e8f6ff;
  font-family: "Tajawal", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#020207);color:var(--text);-webkit-font-smoothing:antialiased;overflow:hidden}
.header{height:64px;display:flex;align-items:center;justify-content:space-between;padding:10px 16px;border-bottom:1px solid rgba(255,255,255,0.02);position:fixed;top:0;left:0;right:0;background:linear-gradient(90deg, rgba(0,0,0,0.35), rgba(0,0,0,0.15));z-index:99}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:46px;height:46;border-radius:12px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:#020202;font-weight:900;font-size:16px}
.title{font-weight:900;font-size:18px}
.controls{display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:var(--primary);cursor:pointer;font-weight:800}
.btn.primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:#000;border:none}
.btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.03)}

.container{position:fixed;top:64px;bottom:0;left:0;right:0;overflow-y:scroll;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch}
.feed-item{position:relative;height:100vh;scroll-snap-align:start;display:flex;align-items:center;justify-content:center;background:#000;overflow:hidden}
.feed-video{width:100%;height:100%;object-fit:cover;background:#000}
.meta{position:absolute;left:16px;bottom:26px;right:86px;display:flex;flex-direction:column;gap:6px;text-align:right;z-index:40}
.meta .user{font-weight:900;font-size:16px}
.meta .title{font-size:14px;color:var(--muted)}
.side-controls{position:absolute;right:12px;bottom:100px;display:flex;flex-direction:column;gap:12px;align-items:center;z-index:50}
.icon{width:56px;height:56;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid rgba(255,255,255,0.03);font-weight:900}
.icon .count{display:block;font-size:12px;color:var(--muted);margin-top:6px;text-align:center}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:200}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);max-width:720px;width:100%}
.form-row{display:flex;gap:8px;align-items:center}
.input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)}
.small{font-size:13px;color:var(--muted)}
.footer-note{position:fixed;left:0;right:0;bottom:0;padding:8px;text-align:center;color:var(--muted);font-size:12px}

/* responsive */
@media(max-width:600px){
  .meta{left:12px;right:70px}
  .icon{width:48px;height:48}
}
</style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="logo">AN</div>
    <div>
      <div class="title">Algeriano_Neo</div>
      <div class="small">Ù…Ù†ØµØ© ÙÙŠØ¯ÙŠÙˆ â€” Ù†Ø³Ø®Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
    </div>
  </div>

  <div class="controls">
    <input id="search" class="input" placeholder="Ø¯ÙˆØ± Ø¹Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ ÙŠÙˆØ²Ø±" style="width:220px">
    <button class="btn" id="btnRandom">Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
    <button class="btn primary" id="btnUpload">Ø±ÙØ¹</button>
    <button class="btn" id="btnProfile">Ø¨Ø±ÙˆÙØ§ÙŠÙ„ÙŠ</button>
  </div>
</header>

<main id="feed" class="container" aria-live="polite"></main>

<div class="footer-note">Algeriano_Neo â€” All rights reserved</div>

<!-- overlay -->
<div id="overlay" class="overlay" aria-hidden="true">
  <div class="card" id="overlayCard"></div>
</div>

<script>
/* Algeriano_Neo â€” single file final app
   Storage: localStorage (videos, comments, likes, settings)
   Features: feed (scroll), upload (file/url), likes, comments, profile, admin quick
*/

const LS_VIDEOS = 'algeriano_videos_final';
const LS_COMMENTS = 'algeriano_comments_final';
const LS_LIKES = 'algeriano_likes_final';
const LS_USERS = 'algeriano_users_final';
const LS_SETTINGS = 'algeriano_settings_final';
const LS_CURRENT = 'algeriano_current_final';

function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function load(k){ return JSON.parse(localStorage.getItem(k) || 'null'); }
function ensure(k,init){ if(!localStorage.getItem(k)) save(k,init); return load(k); }
function uid(){ return Date.now() + Math.floor(Math.random()*999); }

/* Init data */
function initData(){
  ensure(LS_SETTINGS, {siteName:'Algeriano_Neo', baridiNumber:'', adminUser:'admin', adminPass:'admin123'});
  ensure(LS_USERS, [{id:'you', username:'you', display:'Ø£Ù†Øª', coins:0}]);
  ensure(LS_COMMENTS, []);
  ensure(LS_LIKES, {});
  if(!localStorage.getItem(LS_VIDEOS)){
    save(LS_VIDEOS, [
      {id:1, user:'algeriano', title:'ØªØ¬Ø±ÙŠØ¨ÙŠ â€” Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', src:'https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4', likes:120, created:Date.now()-300000},
      {id:2, user:'sara_dz', title:'Ø²Ù‡Ø±Ø©', src:'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4', likes:88, created:Date.now()-200000},
      {id:3, user:'yassine', title:'Ù‚ØµÙŠØ±', src:'https://samplelib.com/lib/preview/mp4/sample-5s.mp4', likes:45, created:Date.now()-100000}
    ]);
  }
  ensure(LS_CURRENT, {username:'you'});
}
initData();

/* Render feed */
function renderFeed(order='latest', filter=''){
  const root = document.getElementById('feed'); root.innerHTML='';
  let vids = ensure(LS_VIDEOS);
  if(order==='latest') vids = vids.sort((a,b)=>b.created - a.created);
  else vids = vids.sort(()=>Math.random()-0.5);
  if(filter) vids = vids.filter(v=> v.title.includes(filter) || v.user.includes(filter));
  vids.forEach(v=>{
    const sec = document.createElement('section'); sec.className='feed-item';
    sec.innerHTML = `
      <video class="feed-video" src="${v.src}" playsinline muted preload="metadata"></video>
      <div class="meta">
        <div class="user">@${v.user}</div>
        <div class="title">${v.title}</div>
      </div>
      <div class="side-controls">
        <div class="icon" data-id="${v.id}" onclick="toggleLike(event)">â¤ <span class="count" id="like-${v.id}">${v.likes||0}</span></div>
        <div class="icon" onclick="openComments(${v.id})">ğŸ’¬</div>
        <div class="icon" onclick="shareVideo('${encodeURIComponent(v.src)}')">ğŸ”—</div>
      </div>`;
    root.appendChild(sec);
  });
  setTimeout(()=> attachObservers(), 50);
}

/* autoplay via IntersectionObserver */
let io;
function attachObservers(){
  const videos = Array.from(document.querySelectorAll('video.feed-video'));
  if(io) io.disconnect();
  io = new IntersectionObserver(entries=>{
    entries.forEach(en=>{
      const v = en.target;
      if(en.isIntersecting && en.intersectionRatio>0.6){ v.muted=false; v.play().catch(()=>{}); }
      else v.pause();
    });
  }, {threshold:[0.6]});
  videos.forEach(v=> io.observe(v));
}

/* Likes */
function toggleLike(e){
  const id = parseInt(e.currentTarget.dataset.id);
  const likes = ensure(LS_LIKES);
  const user = ensure(LS_CURRENT).username;
  const key = `${user}_${id}`;
  if(likes[key]){ delete likes[key]; updateLikes(id,-1); }
  else { likes[key]=true; updateLikes(id,+1); }
  save(LS_LIKES, likes);
  renderLikeUI(id);
}
function updateLikes(id,delta){
  const vids = ensure(LS_VIDEOS);
  const v = vids.find(x=>x.id===id);
  if(v){ v.likes = (v.likes||0)+delta; save(LS_VIDEOS, vids); const el = document.getElementById('like-'+id); if(el) el.innerText = v.likes; }
}
function renderLikeUI(id){
  const likes = ensure(LS_LIKES); const user = ensure(LS_CURRENT).username; const key = `${user}_${id}`; const el = document.querySelector(`[data-id="${id}"]`); if(el) el.style.background = likes[key] ? 'linear-gradient(90deg,var(--primary),var(--accent))' : '';
}

/* Comments overlay */
function openComments(id){
  const comments = ensure(LS_COMMENTS).filter(c=>c.videoId===id);
  const html = `<h3>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
    <div style="max-height:40vh;overflow:auto;margin-top:8px">${comments.map(c=>`<div style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><strong>@${c.user}</strong><div class="small">${c.text}</div></div>`).join('') || '<div class="small">Ù„Ø§ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯</div>'}</div>
    <div style="margin-top:8px" class="form-row"><input id="cText" class="input" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚"><button class="btn primary" onclick="postComment(${id})">Ù†Ø´Ø±</button></div>`;
  showOverlay(html);
}
function postComment(id){
  const txt = document.getElementById('cText').value.trim();
  if(!txt) return alert('Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚');
  const comments = ensure(LS_COMMENTS); const user = ensure(LS_CURRENT).username;
  comments.unshift({id:uid(), videoId:id, user:user, text:txt, created:Date.now()}); save(LS_COMMENTS, comments); closeOverlay(); alert('ØªÙ… Ø§Ù„Ù†Ø´Ø±');
}

/* Overlay helpers */
function showOverlay(html){
  const ov = document.getElementById('overlay'); const card = document.getElementById('overlayCard');
  card.innerHTML = html + '<div style="text-align:left;margin-top:10px"><button class="btn" onclick="closeOverlay()">Ø¥ØºÙ„Ø§Ù‚</button></div>';
  ov.style.display='flex'; ov.setAttribute('aria-hidden','false');
}
function closeOverlay(){ const ov=document.getElementById('overlay'); ov.style.display='none'; ov.setAttribute('aria-hidden','true'); document.getElementById('overlayCard').innerHTML=''; }

/* Upload */
document.getElementById('btnUpload').addEventListener('click', openUpload);
function openUpload(){
  showOverlay(`<h3>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h3>
    <div class="form-row"><input id="upFile" type="file" accept="video/*" class="input"></div>
    <div style="margin-top:8px"><input id="upUrl" placeholder="Ø£Ùˆ Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· mp4" class="input"></div>
    <div style="margin-top:8px"><input id="upTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ" class="input"></div>
    <div style="margin-top:8px"><button class="btn primary" onclick="doUpload()">Ø±ÙØ¹</button></div>
    <div class="small" style="margin-top:8px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø±ÙØ¹ Ù…Ù„ÙØ§Øª ÙƒØ¨ÙŠØ±Ø© Ø¹Ù„Ù‰ localStorage Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ â€” Ø§Ø³ØªØ¹Ù…Ù„ Ø±ÙˆØ§Ø¨Ø· Ø¥Ù† Ø£Ù…ÙƒÙ†</div>`);
}
function doUpload(){
  const f = document.getElementById('upFile')?.files?.[0]; const url = document.getElementById('upUrl')?.value.trim(); const title = document.getElementById('upTitle')?.value.trim()||'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
  if(f){
    const r = new FileReader();
    r.onload = function(e){ addVideo({src:e.target.result, title}); closeOverlay(); alert('ØªÙ… Ø§Ù„Ø±ÙØ¹ (Ù…Ø­Ù„ÙŠ)'); };
    r.readAsDataURL(f); return;
  }
  if(url){ addVideo({src:url, title}); closeOverlay(); alert('ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©'); return; }
  alert('Ø§Ø®ØªØ§Ø± Ù…Ù„Ù Ø£Ùˆ Ø±Ø§Ø¨Ø·');
}
function addVideo({src,title}){ const vids = ensure(LS_VIDEOS); const id=uid(); vids.unshift({id:id, user:ensure(LS_CURRENT).username||'you', title:title, src:src, likes:0, created:Date.now()}); save(LS_VIDEOS, vids); renderFeed(); }

/* Profile */
document.getElementById('btnProfile').addEventListener('click', openProfile);
function openProfile(){
  const cur = ensure(LS_CURRENT);
  showOverlay(`<h3>Ø¨Ø±ÙˆÙØ§ÙŠÙ„ÙŠ â€” @${cur.username}</h3><div class="small">Coins: ${cur.coins||0}</div><div style="margin-top:8px"><button class="btn" onclick="logout()">Ø®Ø±ÙˆØ¬</button></div><h4 style="margin-top:12px">ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªÙŠ</h4><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px">${ensure(LS_VIDEOS).filter(v=>v.user===cur.username).map(v=>`<div style="background:#071018;border-radius:8px;padding:8px;text-align:center;cursor:pointer" onclick="openFromThumb('${encodeURIComponent(v.src)}')">${v.title}</div>`).join('')||'<div class="small">Ù„Ø§ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</div>'}</div>`);
}
function openFromThumb(enc){ const src=decodeURIComponent(enc); const vids=ensure(LS_VIDEOS); const v=vids.find(x=>x.src===src); if(v){ const idx=vids.indexOf(v); vids.splice(idx,1); vids.unshift(v); save(LS_VIDEOS, vids); renderFeed(); closeOverlay(); document.querySelector('.container')?.scrollTo({top:0,behavior:'smooth'}); } }
function logout(){ if(confirm('ØªØ±ÙŠØ¯ ØªØ®Ø±Ø¬ØŸ')){ save(LS_CURRENT,{username:'guest'}); closeOverlay(); alert('ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬'); } }

/* Search & Random */
document.getElementById('search').addEventListener('input', (e)=>{ const v=e.target.value.trim(); if(v.length>0) renderFeed('latest', v); else renderFeed('latest',''); });
document.getElementById('btnRandom').addEventListener('click', ()=>{ renderFeed('random',''); document.getElementById('feed').scrollTo({top:0,behavior:'smooth'}); });

/* Admin quick: double-click header to open admin panel (local) */
document.querySelector('.header').addEventListener('dblclick', ()=>{
  const settings = ensure(LS_SETTINGS);
  const u = prompt('Ø§Ø³Ù… Ø§Ù„Ø§Ø¯Ù…Ù†','admin'); const p = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±','admin123');
  if(u===settings.adminUser && p===settings.adminPass){
    showOverlay(`<h3>Ù„ÙˆØ­Ø© Admin â€” Algeriano_Neo</h3>
      <div class="small">Ø¹Ø¯Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª: ${ensure(LS_VIDEOS).length}</div>
      <div style="margin-top:8px"><button class="btn" onclick="clearVideos()">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</button></div>
      <div style="margin-top:8px"><button class="btn" onclick="showPayments()">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹</button></div>
      <div style="margin-top:8px"><button class="btn ghost" onclick="closeOverlay()">Ø¥ØºÙ„Ø§Ù‚</button></div>`);
  } else alert('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø®Ø§Ø·Ø¦Ø©');
});

function clearVideos(){ if(confirm('ØªØ£ÙƒÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªØŸ')){ save(LS_VIDEOS,[]); renderFeed(); closeOverlay(); alert('ØªÙ… Ø§Ù„Ù…Ø³Ø­'); } }

/* Payments (manual flow) */
function showPayments(){
  const payments = ensure('algeriano_payments_final', []);
  const settings = ensure(LS_SETTINGS);
  const html = `<h3>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ (BaridiMob placeholder)</h3>
    <div class="small">BaridiMob: ${settings.baridiNumber || '(ÙØ§Ø±Øº) â€” Ø¹Ø¯Ù„ ÙÙŠ Admin Ù„Ø§Ø­Ù‚Ù‹Ø§'}</div>
    <div style="margin-top:8px">${payments.length? payments.map(p=>`<div style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><strong>@${p.user}</strong> â€” ${p.amount} Ø¯Ø¬<div style="margin-top:6px"><img src="${p.receipt}" style="max-width:160px;border-radius:6px"></div><div style="margin-top:6px"><button class="btn" onclick="confirmPayment(${p.id})">Ù‚Ø¨ÙˆÙ„</button> <button class="btn ghost" onclick="rejectPayment(${p.id})">Ø±ÙØ¶</button></div></div>`).join('') : '<div class="small">Ù…Ø§ÙƒØ§Ù† Ø­ØªÙ‰ Ø·Ù„Ø¨</div>'}</div>
    <div style="margin-top:8px"><button class="btn ghost" onclick="closeOverlay()">Ø¥ØºÙ„Ø§Ù‚</button></div>`;
  showOverlay(html);
}
function confirmPayment(id){
  let payments = ensure('algeriano_payments_final', []);
  const idx = payments.findIndex(x=>x.id===id); if(idx===-1) return;
  payments[idx].status='confirmed'; save('algeriano_payments_final', payments);
  // grant coins simple: 1 coin = 10 DZD
  const users = ensure(LS_USERS);
  let u = users.find(x=>x.username===payments[idx].user); if(!u){ u={id:payments[idx].user, username:payments[idx].user, display:payments[idx].user, coins:0}; users.push(u); }
  const coins = Math.round(payments[idx].amount/10); u.coins = (u.coins||0) + coins; save(LS_USERS, users);
  alert('ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ùˆ Ø§Ù„Ù…Ø¨Ù„Øº ØªØ­ÙˆÙ„ Ù„Ù†Ù‚Ø§Ø·: ' + coins + ' coins'); renderFeed(); closeOverlay();
}
function rejectPayment(id){ let payments=ensure('algeriano_payments_final',[]); const idx=payments.findIndex(x=>x.id===id); if(idx===-1) return; payments[idx].status='rejected'; save('algeriano_payments_final', payments); alert('ØªÙ… Ø§Ù„Ø±ÙØ¶'); renderFeed(); closeOverlay(); }

/* create payment (user flow) */
function createPayment(amount,note,receiptDataUrl){
  const payments = ensure('algeriano_payments_final', []);
  const current = ensure(LS_CURRENT);
  const id = uid();
  payments.unshift({id:id, user:current.username, amount:amount, note:note, receipt:receiptDataUrl, status:'pending', created:Date.now()});
  save('algeriano_payments_final', payments);
}

/* Payment overlay for users */
function openPaymentFlow(){
  showOverlay(`<h3>Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ â€” BaridiMob</h3>
    <div class="small">Ø§Ù†Ø³Ø® Ø±Ù‚Ù… BaridiMob Ùˆ Ù‚Ù… Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø«Ù… Ø§Ø±ÙÙ‚ ØµÙˆØ±Ø© Ø§Ù„ÙˆØµÙ„</div>
    <div style="margin-top:8px"><input id="payAmount" class="input" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø¬)"></div>
    <div style="margin-top:8px"><input id="payNote" class="input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></div>
    <div style="margin-top:8px"><input id="payReceipt" type="file" accept="image/*"></div>
    <div style="margin-top:8px"><button class="btn primary" onclick="doPayment()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button></div>`);
}
function doPayment(){
  const amount = parseInt(document.getElementById('payAmount').value||0);
  const note = document.getElementById('payNote').value||'';
  const file = document.getElementById('payReceipt').files[0];
  if(!amount || !file) return alert('Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ÙˆØ±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ÙˆØµÙ„');
  const r=new FileReader(); r.onload=function(e){ createPayment(amount,note,e.target.result); closeOverlay(); alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ØŒ Admin Ø³ÙŠØ±Ø§Ø¬Ø¹Ù‡'); };
  r.readAsDataURL(file);
}

/* Share utility */
function shareVideo(enc){ const src=decodeURIComponent(enc); if(navigator.share){ navigator.share({title:'Ø´ÙˆÙ Ù‡Ø§Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', url:src}).catch(()=>{}); } else prompt('Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·', src); }

/* export/import data (admin) */
function exportData(){
  const data={videos:ensure(LS_VIDEOS),comments:ensure(LS_COMMENTS),likes:ensure(LS_LIKES),users:ensure(LS_USERS)};
  const blob=new Blob([JSON.stringify(data)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='algeriano_export.json'; a.click();
}

/* helper: open video from profile/thumbnail */
function openFromThumb(enc){ const src=decodeURIComponent(enc); const vids=ensure(LS_VIDEOS); const v=vids.find(x=>x.src===src); if(v){ const idx=vids.indexOf(v); vids.splice(idx,1); vids.unshift(v); save(LS_VIDEOS,vids); renderFeed(); closeOverlay(); document.getElementById('feed').scrollTo({top:0,behavior:'smooth'}); } }

/* initial render & controls */
document.getElementById('btnUpload').addEventListener('click', openUpload);
document.getElementById('btnProfile').addEventListener('click', openProfile);
function setupTopSearch(){
  const s = document.getElementById('search');
  s.addEventListener('input', (e)=>{ const v=e.target.value.trim(); if(v.length>0) renderFeed('latest', v); else renderFeed('latest',''); });
}
document.getElementById('btnRandom').addEventListener('click', ()=>{ renderFeed('random',''); document.getElementById('feed').scrollTo({top:0,behavior:'smooth'}); });

renderFeed(); setupTopSearch();

/* auto-play first visible on load */
window.addEventListener('load', ()=>{ setTimeout(()=>attachObservers(),200); });

</script>

</body>
</html>
