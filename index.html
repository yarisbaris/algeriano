<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Algeriano_Neo â€” Marketplace Escrow (Demo)</title>
<style>
:root{
  --bg-1:#05060a; --bg-2:#0e1116;
  --accent:#00e5ff; --accent2:#7a2bff; --muted:#bfcbd6;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:"Cairo",sans-serif;
  background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:#eef6fb;
  -webkit-font-smoothing:antialiased;
}
/* top */
.top{position:sticky;top:0;z-index:1200;background:rgba(8,8,12,0.55);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,0.02)}
.header-row{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px 18px;gap:12px}
.brand-title{font-weight:900;font-size:20px;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;color:transparent}
.menu-btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#02121a;padding:8px 12px;border-radius:10px;border:none;cursor:pointer}
.news-wrap{background:rgba(255,255,255,0.01);border-top:1px solid rgba(0,229,255,0.03);border-bottom:1px solid rgba(122,43,255,0.03)}
.news{white-space:nowrap;padding:10px 18px;color:var(--accent);animation:news 18s linear infinite}
@keyframes news{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}

/* container */
.container{max-width:1200px;margin:28px auto;padding:0 18px}

/* hero glass */
.glass{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:20px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 20px 60px rgba(0,0,0,0.6);position:relative}
.hero-row{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap}
.hero-left{flex:1;min-width:280px}
.hero-title{font-size:26px;font-weight:900;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;color:transparent;margin-bottom:8px}
.hero-desc{color:var(--muted);margin-bottom:12px}

/* product list */
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:18px}
.product{background:rgba(255,255,255,0.02);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
.product img{width:100%;border-radius:8px;display:block}
.product h3{margin:8px 0;color:#fff}
.product p{color:var(--muted);font-size:14px}
.btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#02121a;border:none;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}

/* modals and forms */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;padding:20px;z-index:1500;visibility:hidden;opacity:0;transition:0.18s}
.modal.show{visibility:visible;opacity:1}
.modal-card{width:100%;max-width:760px;background:#07080b;border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
.form-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
.input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}
.small{width:200px}
.file-input{background:#0b0d10;padding:8px;border-radius:8px;border:1px dashed rgba(255,255,255,0.04);text-align:center;cursor:pointer;color:var(--muted)}

/* transactions list */
.tx-list{margin-top:18px;display:grid;gap:12px}
.tx{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
.tx b{color:var(--accent)}

/* footer */
footer{margin-top:30px;padding:18px;text-align:center;color:var(--muted);border-top:1px solid rgba(255,255,255,0.02)}

/* responsive */
@media(max-width:820px){.hero-row{flex-direction:column-reverse}.hero-right{width:100%}}
</style>
</head>
<body>

<!-- TOP -->
<div class="top" role="banner">
  <div class="header-row">
    <div style="display:flex;align-items:center;gap:12px">
      <div style="width:52px;height:52px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/79/Flag_map_of_Algeria.svg/640px-Flag_map_of_Algeria.svg.png" alt="dz" style="width:40px;height:auto;border-radius:6px">
      </div>
      <div class="brand-title">Algeriano_Neo</div>
    </div>

    <div style="display:flex;gap:10px;align-items:center">
      <button class="menu-btn" id="openMenuBtn">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>
  </div>
  <div class="news-wrap"><div class="news">ğŸ”¥ Algeriano_Neo â€” Ù…Ù†ØµØ© ØªØ¬Ø§Ø±ÙŠØ© Ø¨ÙˆØ³ÙŠØ· Ø¢Ù…Ù†Ø© â€” Ø¬Ø±Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø¢Ù†</div></div>
</div>

<!-- MAIN -->
<div class="container">
  <div class="glass">
    <div class="hero-row">
      <div class="hero-left">
        <div class="hero-title">Ø³ÙˆÙ‚ Ø§Ù„Ù…Ù†ØªØ¬ÙŠÙ† â€” Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ¹ Ø¨ÙˆØ³ÙŠØ·</div>
        <div class="hero-desc">Ù†Ø¸Ø§Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ: Ø¹Ù†Ø¯ Ø´Ø±Ø§Ø¡ Ø£ÙŠ Ù…Ù†ØªÙˆØ¬ ØªØ¶ÙŠÙ Ø¹Ù…Ù„ÙŠØ© Ø¥ÙŠØ¯Ø§Ø¹ Ù…ÙØ¬Ù…Ù‘Ø¯ (Escrow). Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ØªØ¸Ù„ Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù…Ù†ØµØ© Ø­ØªÙ‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù….</div>

        <div style="margin-top:10px">
          <button class="btn" id="btnNewProduct">Ø£Ø¶Ù Ù…Ù†ØªÙˆØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ (Ù„Ù„Ø¨Ø§Ø¦Ø¹)</button>
          <button class="btn" id="btnMyTx" style="margin-left:8px">Ø¹Ø±Ø¶ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙŠ</button>
        </div>

        <!-- product list -->
        <div class="products" id="productsList">
          <!-- populated by JS -->
        </div>
      </div>

      <div class="hero-right" style="width:320px">
        <div class="card" style="background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:12px">
          <h4 style="margin-bottom:8px">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¹ Ø¨ÙˆØ³ÙŠØ·</h4>
          <p style="color:var(--muted);font-size:14px;line-height:1.5">
            1) Ø§Ù„Ù…Ø´ØªØ±ÙŠ ÙŠØ¯ÙØ¹ Ù„Ù„Ù…Ù†ØµØ© â†’ Ø§Ù„Ù…Ø¨Ù„Øº ÙŠÙØ¬Ù…Ù‘ÙØ¯. <br>
            2) Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙŠØ³Ù„Ù… Ø§Ù„Ø³Ù„Ø¹Ø© Ù„Ø´Ø±ÙƒØ© Ø§Ù„ØªÙˆØµÙŠÙ„. <br>
            3) Ø¨Ø¹Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…ØŒ Ø§Ù„Ù…Ù†ØµØ© ØªØ·Ù„Ù‚ Ø§Ù„Ù…Ø§Ù„ Ù„Ù„Ø¨Ø§Ø¦Ø¹.
          </p>
          <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
          <p style="color:var(--muted);font-size:13px">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ: <b>BaridiMob</b> (ØªØ­ÙˆÙŠÙ„ â†’ Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª).</p>
          <p style="margin-top:8px"><small style="color:#9fbfdc">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ù†Ø¸Ø§Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ â€” ØªØ­ØªØ§Ø¬ backend Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ.</small></p>
        </div>
      </div>
    </div>

    <!-- transactions area -->
    <div class="tx-list" id="txListArea">
      <!-- user's transactions -->
    </div>
  </div>

  <!-- sections placeholder -->
  <div style="margin-top:18px" class="sections">
    <div class="section-card" style="padding:14px"><strong>Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø¨ÙˆØ³ÙŠØ·</strong><div style="color:var(--muted);margin-top:6px">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ ÙˆØ¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù€Escrow.</div></div>
    <div class="section-card" style="padding:14px"><strong>Ù‚ÙˆØ§Ø¹Ø¯ ÙˆØ£Ù…Ø§Ù†</strong><div style="color:var(--muted);margin-top:6px">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù…Ù† Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª.</div></div>
  </div>
</div>

<!-- SIDE MENU (off-canvas) -->
<nav id="sideMenu" style="position:fixed;top:0;right:-340px;width:340px;height:100%;background:linear-gradient(180deg,rgba(10,10,12,0.98),rgba(6,6,8,0.96));box-shadow:-30px 0 60px rgba(0,0,0,0.6);padding-top:90px;transition:0.35s;z-index:1300">
  <div style="padding:12px;display:flex;flex-direction:column;gap:8px">
    <a href="index.html" style="color:#fff;text-decoration:none;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="commerce.html" style="color:#fff;text-decoration:none;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)">Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø¨ÙˆØ³ÙŠØ·</a>
    <a href="#" style="color:#fff;text-decoration:none;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
    <a href="#" style="color:#fff;text-decoration:none;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)">Ø§Ù„ØªØ±ÙÙŠÙ‡</a>
    <a href="#" style="color:#fff;text-decoration:none;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)">Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</a>
    <a href="#" style="color:#fff;text-decoration:none;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)">Ø§Ù„ØµØ­Ø©</a>
    <a href="#" style="color:#fff;text-decoration:none;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)">Ù‚Ø³Ù… Ø§Ù„Ù…Ø±Ø£Ø©</a>
  </div>
</nav>

<!-- MODALS -->
<!-- Product modal (view & buy) -->
<div class="modal" id="productModal">
  <div class="modal-card">
    <div id="pmContent">
      <!-- filled by JS -->
    </div>
    <div style="text-align:left;margin-top:12px">
      <button class="btn" id="pmBuyBtn">Ø´Ø±Ø§Ø¡ Ø¨ÙˆØ³ÙŠØ·</button>
      <button class="btn ghost" id="pmCloseBtn" style="background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
</div>

<!-- Checkout modal -->
<div class="modal" id="checkoutModal">
  <div class="modal-card">
    <h3>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ â€” Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ (BaridiMob)</h3>
    <div id="checkoutInfo" style="margin-top:8px;color:var(--muted)"></div>
    <div class="form-row" style="margin-top:10px">
      <input class="input small" id="buyerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠ">
      <input class="input small" id="buyerPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    </div>
    <div style="margin-top:10px">
      <div style="margin-bottom:6px">ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹ (BaridiMob): Ø£Ø±Ø³Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ Ø«Ù… Ø§Ø±ÙØ¹ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©.</div>
      <div style="background:#081018;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)">
        <strong id="baridiNumber">+213 0550 00 00 00</strong>
      </div>
    </div>
    <div style="margin-top:10px">
      <label class="file-input" id="uploadBtn">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ <input type="file" id="proofFile" accept="image/*" style="display:none"></label>
      <div id="proofPreview" style="margin-top:8px"></div>
    </div>

    <div style="margin-top:12px;text-align:left">
      <button class="btn" id="confirmCheckoutBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¨Ù€Escrow</button>
      <button class="btn ghost" id="cancelCheckoutBtn" style="background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<!-- Transaction details / admin verify modal -->
<div class="modal" id="txModal">
  <div class="modal-card">
    <div id="txModalContent"></div>
    <div style="margin-top:12px;text-align:left">
      <button class="btn" id="adminVerifyBtn">Ø£ÙˆØ§ÙÙ‚ (ØªØ­ÙˆÙŠÙ„ ØµØ­ÙŠØ­)</button>
      <button class="btn ghost" id="txCloseBtn" style="background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
</div>

<footer>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2026 â€” Algeriano_Neo</footer>

<script>
/* ======= simple demo data storage (localStorage) ======= */
const LS_PRODUCTS = 'neo_products_v1';
const LS_TX = 'neo_tx_v1';

/* ======= helpers ======= */
function uid(prefix='ID'){ return prefix+'-'+Math.random().toString(36).substr(2,9); }
function now(){ return new Date().toISOString(); }
function loadJSON(k, d){ try{ return JSON.parse(localStorage.getItem(k)) || d }catch(e){return d} }
function saveJSON(k,v){ localStorage.setItem(k, JSON.stringify(v)); }

/* ======= demo products (create if none) ======= */
let products = loadJSON(LS_PRODUCTS, []);
if(products.length===0){
  products = [
    {id:uid('P'),title:'Ù‡Ø§ØªÙ Ø°ÙƒÙŠ ØªØ¬Ø±ÙŠØ¨ÙŠ',price:25000,desc:'Ù‡Ø§ØªÙ Ø¹Ø±Ø¶ ØªØ¬Ø±ÙŠØ¨ÙŠØŒ Ø­Ø§Ù„Ø© Ù…Ù…ØªØ§Ø²Ø©',img:'https://via.placeholder.com/400x260?text=Phone'},
    {id:uid('P'),title:'Ø³Ù…Ø§Ø¹Ø§Øª Ù„Ø§Ø³Ù„ÙƒÙŠØ©',price:6500,desc:'Ø³Ù…Ø§Ø¹Ø§Øª ØµÙˆØªÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©',img:'https://via.placeholder.com/400x260?text=Headset'},
    {id:uid('P'),title:'Ø³Ø§Ø¹Ù€Ø© Ø°ÙƒÙŠÙ€Ø©',price:12000,desc:'Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù',img:'https://via.placeholder.com/400x260?text=Watch'}
  ];
  saveJSON(LS_PRODUCTS, products);
}

/* ======= transactions list ======= */
let transactions = loadJSON(LS_TX, []);

/* ======= UI elements ======= */
const productsList = document.getElementById('productsList');
const productModal = document.getElementById('productModal');
const pmContent = document.getElementById('pmContent');
const pmCloseBtn = document.getElementById('pmCloseBtn');
const pmBuyBtn = document.getElementById('pmBuyBtn');
const checkoutModal = document.getElementById('checkoutModal');
const checkoutInfo = document.getElementById('checkoutInfo');
const buyerName = document.getElementById('buyerName');
const buyerPhone = document.getElementById('buyerPhone');
const proofFile = document.getElementById('proofFile');
const uploadBtn = document.getElementById('uploadBtn');
const proofPreview = document.getElementById('proofPreview');
const confirmCheckoutBtn = document.getElementById('confirmCheckoutBtn');
const cancelCheckoutBtn = document.getElementById('cancelCheckoutBtn');
const txListArea = document.getElementById('txListArea');
const txModal = document.getElementById('txModal');
const txModalContent = document.getElementById('txModalContent');
const adminVerifyBtn = document.getElementById('adminVerifyBtn');
const txCloseBtn = document.getElementById('txCloseBtn');
const sideMenu = document.getElementById('sideMenu');
const openMenuBtn = document.getElementById('openMenuBtn');
const btnNewProduct = document.getElementById('btnNewProduct');
const btnMyTx = document.getElementById('btnMyTx');

/* ======= render products ======= */
function renderProducts(){
  productsList.innerHTML = '';
  products.forEach(p=>{
    const el = document.createElement('div'); el.className='product';
    el.innerHTML = `
      <img src="${p.img}" alt="">
      <h3>${p.title}</h3>
      <p>${p.desc}</p>
      <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
        <div style="font-weight:800;color:var(--accent)">${p.price} Ø¯Ø¬</div>
        <div style="flex:1"></div>
        <button class="btn" onclick="openProduct('${p.id}')">Ø¹Ø±Ø¶</button>
      </div>
    `;
    productsList.appendChild(el);
  });
}
renderProducts();

/* ======= open product modal ======= */
let currentProduct=null;
function openProduct(pid){
  currentProduct = products.find(x=>x.id===pid);
  pmContent.innerHTML = `
    <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
      <img src="${currentProduct.img}" style="width:220px;border-radius:8px" />
      <div style="flex:1">
        <h2 style="margin-bottom:6px">${currentProduct.title}</h2>
        <div style="color:var(--muted);margin-bottom:8px">${currentProduct.desc}</div>
        <div style="font-weight:900;color:var(--accent)">${currentProduct.price} Ø¯Ø¬</div>
      </div>
    </div>
  `;
  productModal.classList.add('show');
}
pmCloseBtn.addEventListener('click', ()=> productModal.classList.remove('show'));

/* ======= buy flow ======= */
pmBuyBtn.addEventListener('click', ()=> {
  if(!currentProduct) return;
  productModal.classList.remove('show');
  // show checkout modal and fill info
  checkoutInfo.innerHTML = `<div>Ø§Ù„Ø³Ù„Ø¹Ø©: <b>${currentProduct.title}</b> â€” Ø§Ù„Ø³Ø¹Ø±: <b>${currentProduct.price} Ø¯Ø¬</b></div>
    <div style="margin-top:8px;color:var(--muted)">Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ©: <span id="fee">5%</span> â€” Ø±Ø³ÙˆÙ… ØªÙˆØµÙŠÙ„ (ØªÙ‚Ø¯ÙŠØ±ÙŠØ©)</div>`;
  buyerName.value=''; buyerPhone.value=''; proofPreview.innerHTML='';
  checkoutModal.classList.add('show');
});

/* file upload handling */
uploadBtn.addEventListener('click', ()=> proofFile.click());
proofFile.addEventListener('change', function(){
  const f = this.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = e=>{
    proofPreview.innerHTML = `<img src="${e.target.result}" style="max-width:180px;border-radius:8px">`;
    proofPreview.dataset.data = e.target.result;
  };
  reader.readAsDataURL(f);
});

/* confirm checkout => create escrow transaction */
confirmCheckoutBtn.addEventListener('click', ()=>{
  const name = buyerName.value.trim(); const phone = buyerPhone.value.trim();
  if(!name || !phone){ alert('Ø¹Ø§ÙØ§Ùƒ Ø¹ÙØ¨Ù‘ÙŠ Ø§Ù„Ø§Ø³Ù… Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'); return; }
  const proof = proofPreview.dataset.data || null;
  const tx = {
    id: uid('ESC'),
    productId: currentProduct.id,
    productTitle: currentProduct.title,
    buyerName: name,
    buyerPhone: phone,
    amount: currentProduct.price,
    feePercent: 5,
    status: proof ? 'pending_verification' : 'waiting_payment',
    proof: proof,
    createdAt: now(),
    history:[ {at:now(),note:'Ø·Ù„Ø¨ Ø£Ù†Ø´Ø¦'} ]
  };
  transactions.unshift(tx);
  saveJSON(LS_TX, transactions);
  checkoutModal.classList.remove('show');
  refreshTxList();
  alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨. Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¢Ù†: ' + tx.status);
});

/* render tx list (user view) */
function refreshTxList(){
  txListArea.innerHTML = '';
  if(transactions.length===0){ txListArea.innerHTML = '<div style="color:var(--muted);padding:12px">Ù…Ø§ÙƒÙŠÙ† Ø­ØªÙ‰ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>'; return; }
  transactions.forEach(tx=>{
    const div = document.createElement('div'); div.className='tx';
    div.innerHTML = `
      <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div><b>${tx.productTitle}</b><div style="color:var(--muted);font-size:13px">${tx.createdAt}</div></div>
        <div style="text-align:left">
          <div style="font-weight:800;color:var(--accent)">${tx.amount} Ø¯Ø¬</div>
          <div style="margin-top:6px"><button class="btn" onclick="openTx('${tx.id}')">ØªÙØ§ØµÙŠÙ„</button></div>
        </div>
      </div>
      <div style="margin-top:8px;color:${tx.status==='completed'?'#6bd18f':tx.status==='pending_verification'?'#f6d365':'#ffd480'}">Ø§Ù„Ø­Ø§Ù„Ø©: ${tx.status}</div>
    `;
    txListArea.appendChild(div);
  });
}
refreshTxList();

/* open tx modal */
function openTx(tid){
  const tx = transactions.find(x=>x.id===tid);
  if(!tx) return;
  let html = `<h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ â€” ${tx.id}</h3>
    <div style="margin-top:8px"><b>Ø§Ù„Ù…Ù†ØªØ¬:</b> ${tx.productTitle}</div>
    <div style="margin-top:4px"><b>Ø§Ù„Ù…Ø´ØªØ±ÙŠ:</b> ${tx.buyerName} â€” ${tx.buyerPhone}</div>
    <div style="margin-top:4px"><b>Ø§Ù„Ù…Ø¨Ù„Øº:</b> ${tx.amount} Ø¯Ø¬</div>
    <div style="margin-top:6px"><b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> ${tx.status}</div>
    <div style="margin-top:8px"><b>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</b> ${tx.createdAt}</div>`;
  if(tx.proof){ html += `<div style="margin-top:10px"><b>Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹:</b><div style="margin-top:6px"><img src="${tx.proof}" style="max-width:320px;border-radius:8px"></div></div>`; }
  html += `<div style="margin-top:10px"><b>Ø§Ù„Ø³Ø¬Ù„:</b><div style="color:var(--muted);margin-top:6px">${tx.history.map(h=>'- '+h.note+' ('+h.at+')').join('<br>')}</div></div>`;
  // action buttons vary by status
  let actions = '';
  if(tx.status==='waiting_payment'){
    actions = `<button class="btn" onclick="markPaid('${tx.id}')">ØªØ³Ø¬ÙŠÙ„ Ø£Ù† Ø§Ù„Ù…Ø´ØªØ±ÙŠ Ù‚Ø§Ù„ Ø¯ÙØ¹Øª (Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª)</button>`;
  } else if(tx.status==='pending_verification'){
    actions = `<button class="btn" onclick="adminApprove('${tx.id}')">Ø£ÙˆØ§ÙÙ‚ (Ø§Ù„ØªØ­ÙˆÙŠÙ„ ØµØ­ÙŠØ­)</button>
               <button class="btn ghost" onclick="adminReject('${tx.id}')">Ø±ÙØ¶</button>`;
  } else if(tx.status==='paid_waiting_delivery'){
    actions = `<button class="btn" onclick="sellerMarkedDelivered('${tx.id}')">Ø§Ù„Ø¨Ø§Ø¦Ø¹: ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ø´Ø±ÙƒØ© Ø§Ù„ØªÙˆØµÙŠÙ„</button>`;
  } else if(tx.status==='in_transit'){
    actions = `<button class="btn" onclick="buyerConfirmReceived('${tx.id}')">Ø§Ù„Ù…Ø´ØªØ±ÙŠ: ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>`;
  }
  txModalContent.innerHTML = html + '<div style="margin-top:12px">' + actions + '</div>';
  txModal.classList.add('show');
}

/* modal close */
document.getElementById('txCloseBtn').addEventListener('click', ()=> txModal.classList.remove('show'));

/* markPaid: simulate buyer uploading proof after order created without proof */
function markPaid(tid){
  const tx = transactions.find(x=>x.id===tid);
  if(!tx) return alert('Ø®Ø·Ø£');
  // open small prompt to paste image data URL (in demo) or ask to select file: we'll simulate by asking confirm
  const ok = confirm('Ø³ØªØ­Ù…Ù„ Ø§Ù„Ø¢Ù†/Ø£Ùˆ ØªØ¶ÙŠÙ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹. ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø³ÙŠØ­Ø³Ø¨ ÙƒÙ€ "pending_verification". Ø§Ø¶ØºØ· Ù†Ø¹Ù… Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.');
  if(!ok) return;
  tx.proof = tx.proof || null; // in demo nothing, so stays null
  tx.status = 'pending_verification';
  tx.history.push({at:now(),note:'Ø§Ù„Ù…Ø´ØªØ±ÙŠ Ø£ÙØ¨Ù„Øº Ø£Ù†Ù‡ Ø¯ÙØ¹ ÙˆØ£Ø±Ø³Ù„ Ø¥Ø«Ø¨Ø§Øª'});
  saveJSON(LS_TX, transactions);
  txModal.classList.remove('show');
  refreshTxList();
  alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©: pending_verification â€” Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø³ØªØ±Ø§Ø¬Ø¹.');
}

/* admin approve (verify proof) */
function adminApprove(tid){
  const tx = transactions.find(x=>x.id===tid);
  if(!tx) return;
  tx.status = 'paid_waiting_delivery';
  tx.history.push({at:now(),note:'Ø§Ù„Ø§Ø¯Ø§Ø±Ø© ØªØ£ÙƒØ¯Øª Ù…Ù† Ø§Ù„Ø¯ÙØ¹'});
  saveJSON(LS_TX, transactions);
  txModal.classList.remove('show');
  refreshTxList();
  alert('ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯ â€” Ø§Ù„Ø¢Ù† Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ³Ù„Ù… Ø§Ù„Ø³Ù„Ø¹Ø© Ù„Ø´Ø±ÙƒØ© Ø§Ù„ØªÙˆØµÙŠÙ„.');
}

/* admin reject */
function adminReject(tid){
  const tx = transactions.find(x=>x.id===tid);
  if(!tx) return;
  tx.status = 'payment_rejected';
  tx.history.push({at:now(),note:'Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø±ÙØ¶Øª Ø§Ù„Ø¥Ø«Ø¨Ø§Øª'});
  saveJSON(LS_TX, transactions);
  txModal.classList.remove('show');
  refreshTxList();
  alert('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¯ÙØ¹ â€” Ø§ØªØµÙ„ Ø¨Ø§Ù„Ù…Ø´ØªØ±ÙŠ.');
}

/* seller marks delivered to courier */
function sellerMarkedDelivered(tid){
  const tx = transactions.find(x=>x.id===tid);
  if(!tx) return;
  tx.status = 'in_transit';
  tx.history.push({at:now(),note:'Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ø³Ù„Ù‘Ù… Ø§Ù„Ø³Ù„Ø¹Ø© Ù„Ø´Ø±ÙƒØ© Ø§Ù„ØªÙˆØµÙŠÙ„'});
  saveJSON(LS_TX, transactions);
  txModal.classList.remove('show');
  refreshTxList();
  alert('ØªÙ… ØªØ­Ø¯ÙŠØ«: ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ (in_transit).');
}

/* buyer confirm received */
function buyerConfirmReceived(tid){
  const tx = transactions.find(x=>x.id===tid);
  if(!tx) return;
  tx.status = 'completed';
  tx.history.push({at:now(),note:'Ø§Ù„Ù…Ø´ØªØ±ÙŠ Ø£ÙƒØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… â€” Ø§Ù„Ù…Ù†ØµØ© ØµØ±ÙØª Ø§Ù„Ù…Ø§Ù„ Ù„Ù„Ø¨Ø§Ø¦Ø¹'});
  saveJSON(LS_TX, transactions);
  txModal.classList.remove('show');
  refreshTxList();
  alert('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø·Ù„Ø¨ â€” Ù…ÙƒØªÙ…Ù„.');
}

/* utility open tx from list */
window.openTx = openTx;
window.openProduct = openProduct;

/* new product (simulate seller adding quickly) */
btnNewProduct.addEventListener('click', ()=>{
  const title = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªÙˆØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (ØªØ¬Ø±ÙŠØ¨ÙŠ):','Ù…Ù†ØªÙˆØ¬ Ø¬Ø¯ÙŠØ¯');
  if(!title) return;
  const price = parseInt(prompt('Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬):','1000')) || 1000;
  const p = {id:uid('P'),title,price,desc:'ÙˆØµÙ ØªØ¬Ø±ÙŠØ¨ÙŠ',img:'https://via.placeholder.com/400x260?text=Item'};
  products.unshift(p);
  saveJSON(LS_PRODUCTS, products);
  renderProducts();
});

/* show my transactions */
btnMyTx.addEventListener('click', ()=> {
  if(transactions.length===0) alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.');
  else window.scrollTo({top: document.querySelector('.tx-list').offsetTop - 80, behavior:'smooth'});
});

/* menu open/close */
openMenuBtn.addEventListener('click', (e)=>{
  e.stopPropagation();
  if(sideMenu.style.right === '0px') sideMenu.style.right = '-340px';
  else sideMenu.style.right = '0';
});
document.addEventListener('click',(e)=>{
  if(sideMenu.style.right==='0px'){
    const path = e.composedPath ? e.composedPath() : (e.path || []);
    if(!path.includes(sideMenu) && !path.includes(openMenuBtn)) sideMenu.style.right = '-340px';
  }
});

/* helper functions for storage and ids */
function uid(prefix='id'){ return prefix+'-'+Math.random().toString(36).slice(2,10) }
function now(){ return new Date().toLocaleString() }
function loadJSON(k,d){ try{ return JSON.parse(localStorage.getItem(k)) || d }catch(e){return d} }
function saveJSON(k,v){ localStorage.setItem(k, JSON.stringify(v)) }

</script>
</body>
</html>
