<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Algeriano â€” Ù…Ù†ØµØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</title>

<!-- ====== CSS (Clean Modern) ====== -->
<style>
:root{
  --bg:#0f1720; --card:#0b1220; --muted:#98a0ad;
  --primary:#00c78a; --accent:#6a00ff; --glass: rgba(255,255,255,0.03);
  --text:#f8fafc; --radius:12px; --gap:14px;
  font-family: 'Tajawal', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#07080b);color:var(--text);-webkit-font-smoothing:antialiased}
a{color:inherit;text-decoration:none}
.header{height:64px;display:flex;align-items:center;justify-content:space-between;padding:10px 18px;border-bottom:1px solid rgba(255,255,255,0.02);backdrop-filter: blur(6px)}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:46px;height:46;border-radius:12px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;font-weight:900;color:#010101;font-size:20px}
.title{font-weight:800;font-size:18px}
.top-actions{display:flex;gap:8px;align-items:center}
.btn{background:var(--primary);border:none;color:#021;padding:8px 12px;border-radius:10px;font-weight:800;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text)}
.container{max-width:1100px;margin:18px auto;padding:0 12px}
.layout{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
@media(max-width:980px){ .layout{grid-template-columns:1fr} .suggestions{order:2} .mainVideo{order:1} }
.mainVideo{background:rgba(255,255,255,0.02);border-radius:var(--radius);overflow:hidden;border:1px solid rgba(255,255,255,0.03);height:65vh;display:flex;flex-direction:column}
.mainVideo video{width:100%;height:100%;object-fit:cover;background:#000}
.infoRow{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-top:1px solid rgba(255,255,255,0.02)}
.meta{display:flex;gap:12px;align-items:center}
.avatar{width:48px;height:48;border-radius:999px;background:linear-gradient(135deg,var(--accent),var(--primary));display:flex;align-items:center;justify-content:center;color:#000;font-weight:900}
.actions{display:flex;gap:8px;align-items:center}
.iconBtn{background:var(--glass);border-radius:10px;padding:8px 10px;border:1px solid rgba(255,255,255,0.02);cursor:pointer;color:var(--primary);font-weight:800}
.suggestions{width:100%;max-width:360px}
.suggestions h3{margin:0 0 10px 0;color:var(--muted);font-weight:800}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:10px;border-radius:10px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.02);display:flex;gap:10px;align-items:center}
.card img{width:94px;height:64px;border-radius:8px;object-fit:cover}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
.grid .cell{background:#071018;border-radius:10px;padding:12px;text-align:center;min-height:90px}
.footer{padding:24px;text-align:center;color:var(--muted);margin-top:20px}

/* forms */
.input, textarea, select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)}
.label{font-weight:700;color:var(--muted);margin-bottom:6px;display:block}

/* admin */
.admin-shell{display:flex;gap:14px}
.aside{width:260px;background:linear-gradient(180deg,#07101a,#05060a);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
.aside .item{padding:10px;border-radius:10px;cursor:pointer;color:var(--muted);margin-bottom:8px}
.aside .item.active{background:rgba(255,255,255,0.02);color:var(--text);font-weight:800}
.admin-main{flex:1;background:linear-gradient(180deg,#06070a,#05050a);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}

/* small */
.small{font-size:13px;color:var(--muted)}

/* responsive */
@media(max-width:600px){
  .header{padding:8px}
  .title{font-size:16px}
  .mainVideo{height:48vh}
  .grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<!-- ====== Header ====== -->
<header class="header">
  <div class="brand">
    <div class="logo">A</div>
    <div>
      <div class="title">Algeriano</div>
      <div class="small">Ù…Ù†ØµØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© â€” ØªØ¬Ø±ÙŠØ¨ÙŠ</div>
    </div>
  </div>

  <div class="top-actions">
    <button class="btn ghost" onclick="go('#upload')">+ Ø²ÙŠØ¯ ÙÙŠØ¯ÙŠÙˆ</button>
    <button class="btn ghost" onclick="go('#profile')">Ø¨Ø±ÙˆÙØ§ÙŠÙ„ÙŠ</button>
    <button class="btn" onclick="go('#admin')">Admin</button>
  </div>
</header>

<!-- ====== Main ====== -->
<main class="container">
  <div id="view-root"></div>
</main>

<!-- ====== Templates (rendered by JS) ====== -->
<script>
/* ========== Simple Router ========== */
function go(hash){ location.hash = hash; }
window.addEventListener('hashchange', renderRoute);
function onLoad(){ if(!location.hash) location.hash='#home'; renderRoute(); }
function renderRoute(){
  const root = document.getElementById('view-root');
  const h = location.hash.replace('#','') || 'home';
  if(h==='home') root.innerHTML = HomeHTML();
  else if(h==='upload') root.innerHTML = UploadHTML();
  else if(h==='profile') root.innerHTML = ProfileHTML();
  else if(h==='admin') root.innerHTML = AdminHTML();
  else if(h==='payments') root.innerHTML = PaymentsHTML();
  else root.innerHTML = HomeHTML();
  // hydrate after HTML injection
  setTimeout(hydrate,50);
}

/* ========== Local Storage Keys & Helpers ========== */
const LS_VIDEOS = 'alg_videos_v3';
const LS_PAYMENTS = 'alg_payments_v3';
const LS_USERS = 'alg_users_v3';
const LS_SETTINGS = 'alg_settings_v3';

function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
function load(key){ return JSON.parse(localStorage.getItem(key) || 'null'); }
function ensure(key, init){ if(!localStorage.getItem(key)) save(key,init); return load(key); }

/* ========== Init sample data if empty ========== */
function initData(){
  ensure(LS_SETTINGS, {siteName:'Algeriano', baridiNumber:'', adminUser:'admin', adminPass:'admin123'});
  if(!localStorage.getItem(LS_VIDEOS)){
    save(LS_VIDEOS, [
      {id:1, title:'ØªØ¬Ø±ÙŠØ¨ÙŠ â€” Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', user:'algeriano', src:'https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4', likes:120, created:Date.now()},
      {id:2, title:'Ø²Ù‡Ø±Ø©', user:'sara_dz', src:'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4', likes:88, created:Date.now()-60000},
      {id:3, title:'Ù‚ØµÙŠØ±', user:'yassine', src:'https://samplelib.com/lib/preview/mp4/sample-5s.mp4', likes:45, created:Date.now()-120000}
    ]);
  }
  if(!localStorage.getItem(LS_PAYMENTS)) save(LS_PAYMENTS, []);
  if(!localStorage.getItem(LS_USERS)) save(LS_USERS, [{id:'guest', username:'guest', display:'Ø²Ø§Ø¦Ø±', coins:0}]);
}
initData();

/* ========== UI Templates ========== */
function HomeHTML(){
  return `
  <div class="layout">
    <section class="mainVideo">
      <video id="heroVideo" controls playsinline></video>
      <div class="infoRow">
        <div class="meta">
          <div class="avatar">A</div>
          <div style="text-align:right">
            <div id="heroTitle" style="font-weight:800"></div>
            <div class="small" id="heroUser"></div>
          </div>
        </div>
        <div class="actions">
          <button class="iconBtn" id="likeBtn">â¤ <span id="heroLikes">0</span></button>
          <button class="iconBtn" onclick="shareCurrent()">ğŸ”</button>
          <button class="btn" id="buyBtn">Ø§Ø´ØªØ±Ù</button>
        </div>
      </div>
    </section>

    <aside class="suggestions">
      <h3>Ù…Ù‚ØªØ±Ø­Ø§Øª Ù„ÙŠÙƒ</h3>
      <div id="suggestGrid"></div>
      <div style="margin-top:14px">
        <h4 class="small">Ù‚Ø³Ù… ØªØ¬Ø§Ø±ÙŠ</h4>
        <div class="grid">
          <div class="cell">Ù…Ù†ØªÙˆØ¬ 1<br><small class="small">500 Ø¯Ø¬</small></div>
          <div class="cell">Ù…Ù†ØªÙˆØ¬ 2<br><small class="small">1200 Ø¯Ø¬</small></div>
          <div class="cell">Ù…Ù†ØªÙˆØ¬ 3<br><small class="small">250 Ø¯Ø¬</small></div>
        </div>
      </div>
    </aside>
  </div>
  <div class="footer">Â© <strong>${ensure(LS_SETTINGS).siteName}</strong> â€” Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</div>
  `;
}

function UploadHTML(){
  return `
  <div style="max-width:800px;margin:auto">
    <h2>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h2>
    <p class="small">ØªØ±Ø³Ù„ Ù…Ù„Ù MP4 Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ø£Ùˆ ØªØµÙ‚ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± (mp4). Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ®Ø²Ù† Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.</p>

    <div style="margin-top:12px">
      <label class="label">Ø§Ø®ØªØ§Ø± Ù…Ù„Ù (MP4)</label>
      <input id="fileInput" type="file" accept="video/*">
    </div>

    <div style="margin-top:12px">
      <label class="label">Ø£Ùˆ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ (mp4)</label>
      <input id="urlInput" placeholder="https://...video.mp4">
    </div>

    <div style="margin-top:12px">
      <label class="label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
      <input id="titleInput" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
    </div>

    <div style="margin-top:12px;display:flex;gap:8px">
      <button class="btn" onclick="handleUpload()">Ø±ÙØ¹ ÙˆÙ†Ø´Ø±</button>
      <button class="btn ghost" onclick="go('#home')">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
  `;
}

function ProfileHTML(){
  const me = currentUser();
  return `
  <div style="max-width:900px;margin:auto">
    <div style="display:flex;gap:12px;align-items:center">
      <div class="avatar" style="width:88px;height:88px">${(me.display||me.username).slice(0,1)}</div>
      <div>
        <div style="font-weight:900">@${me.username}</div>
        <div class="small">Coins: <strong id="myCoins">${me.coins||0}</strong></div>
      </div>
    </div>

    <h3 style="margin-top:18px">ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªÙŠ</h3>
    <div class="grid" id="myGrid"></div>
  </div>
  `;
}

function AdminHTML(){
  const settings = ensure(LS_SETTINGS);
  return `
  <div class="admin-shell">
    <aside class="aside">
      <div style="font-weight:900;margin-bottom:8px">${settings.siteName} â€” Admin</div>
      <div class="item active" onclick="showAdminTab('overview')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      <div class="item" onclick="showAdminTab('videos')">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</div>
      <div class="item" onclick="showAdminTab('users')">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
      <div class="item" onclick="showAdminTab('payments')">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div>
      <div style="margin-top:12px">
        <div class="small">BaridiMob (placeholder)</div>
        <input id="baridiNumberInput" class="input" placeholder="07XXXXXXXX" value="${settings.baridiNumber||''}" style="margin-top:8px">
        <div style="margin-top:8px"><button class="btn" onclick="saveBaridi()">Ø­ÙØ¸</button></div>
      </div>
      <div style="margin-top:16px"><button class="btn ghost" onclick="logoutAdmin()">Ø®Ø±ÙˆØ¬</button></div>
    </aside>

    <main class="admin-main" id="adminMain">
      <div id="adminOverview">
        <h3>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h3>
        <div style="display:flex;gap:12px">
          <div style="background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;min-width:140px">
            <div class="small">Ø§Ù„Ù…Ù„Ø®Øµ</div>
            <div style="font-weight:900;font-size:22px" id="countVideos">--</div>
            <div class="small">ÙÙŠØ¯ÙŠÙˆ</div>
          </div>
          <div style="background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;min-width:140px">
            <div class="small">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div>
            <div style="font-weight:900;font-size:22px" id="countPayments">--</div>
            <div class="small">Ø·Ù„Ø¨Ø§Øª</div>
          </div>
        </div>
      </div>

      <div id="adminVideos" style="display:none;margin-top:12px">
        <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h3>
        <table style="width:100%;border-collapse:collapse"><thead><tr><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø£ÙØ¹Ø§Ù„</th></tr></thead>
        <tbody id="videosTableBody"></tbody></table>
      </div>

      <div id="adminUsers" style="display:none;margin-top:12px">
        <h3>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
        <table style="width:100%"><thead><tr><th>Ø§Ù„ÙŠÙˆØ²Ø±</th><th>Coins</th><th>Ø£ÙØ¹Ø§Ù„</th></tr></thead>
        <tbody id="usersTableBody"></tbody></table>
      </div>

      <div id="adminPayments" style="display:none;margin-top:12px">
        <h3>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹</h3>
        <div id="paymentsList"></div>
      </div>
    </main>
  </div>
  `;
}

function PaymentsHTML(){
  const settings = ensure(LS_SETTINGS);
  return `
  <div style="max-width:720px;margin:auto">
    <h3>Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ â€” BaridiMob</h3>
    <p class="small">Ø¨Ø§Ø´ ØªØ´Ø±ÙŠ: Ø§ØªØ¨Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ§Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„ÙˆØµÙ„.</p>

    <div style="margin-top:12px">
      <label class="label">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø¬)</label>
      <input id="payAmount" type="number" placeholder="Ù…Ø«Ø§Ù„: 200">
    </div>

    <div style="margin-top:12px">
      <label class="label">Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø¯ÙØ¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <input id="payNote" placeholder="Ù…Ø«Ø§Ù„: ØªØ­ÙˆÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ VIP">
    </div>

    <div style="margin-top:12px">
      <label class="label">Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ÙˆØµÙ„</label>
      <input id="payReceipt" type="file" accept="image/*">
    </div>

    <div style="margin-top:12px;display:flex;gap:8px">
      <button class="btn" onclick="createPayment()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
      <button class="btn ghost" onclick="go('#home')">Ø¥Ù„ØºØ§Ø¡</button>
    </div>

    <div style="margin-top:18px" class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Admin Ø³ÙŠØ±Ø§Ø¬Ø¹ Ø§Ù„Ø·Ù„Ø¨ ÙˆÙŠØ¤ÙƒØ¯Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹.</div>
  </div>
  `;
}

/* ========== Hydration (attach event handlers & render dynamic data) ========== */
function hydrate(){
  // Home
  const vidEl = document.getElementById('heroVideo');
  if(vidEl){
    renderFeed();
    document.getElementById('likeBtn').onclick = function(){ likeCurrent(); };
    document.getElementById('buyBtn').onclick = function(){ go('#payments'); };
    // autoplay first
    vidEl.onplay = ()=>{};
  }

  // Upload
  const fileInput = document.getElementById('fileInput');
  if(fileInput) {
    // nothing extra
  }

  // Profile
  if(document.getElementById('myGrid')) renderProfileGrid();

  // Admin
  if(document.getElementById('countVideos')) renderAdminOverview();
  if(document.getElementById('videosTableBody')) renderAdminVideos();
  if(document.getElementById('usersTableBody')) renderAdminUsers();
  if(document.getElementById('paymentsList')) renderAdminPayments();

  // Save baridi number input on change
  const barInput = document.getElementById('baridiNumberInput');
  if(barInput){ barInput.onchange = ()=>{}; }
}

/* ========== Data operations ========== */
function getVideos(){ return ensure(LS_VIDEOS); }
function setVideos(v){ save(LS_VIDEOS,v); }

function renderFeed(){
  const videos = getVideos();
  if(!videos || !videos.length) return;
  const first = videos[0];
  const vid = document.getElementById('heroVideo');
  vid.src = first.src;
  document.getElementById('heroTitle').innerText = first.title;
  document.getElementById('heroUser').innerText = '@'+first.user;
  document.getElementById('heroLikes').innerText = first.likes || 0;

  const grid = document.getElementById('suggestGrid'); grid.innerHTML='';
  for(let i=1;i<videos.length;i++){
    const v = videos[i];
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `<img src="https://via.placeholder.com/180x120.png?text=AL+${v.id}"><div style="flex:1;text-align:right"><div style="font-weight:900">${v.title}</div><div class="small">${v.user}</div></div>`;
    div.onclick = ()=>{ playVideoById(v.id); };
    grid.appendChild(div);
  }
}

function playVideoById(id){
  const videos = getVideos();
  const v = videos.find(x=>x.id===id);
  if(v){
    // move it to top
    const idx = videos.indexOf(v);
    videos.splice(idx,1);
    videos.unshift(v);
    setVideos(videos);
    renderFeed();
    go('#home');
  }
}

function likeCurrent(){
  const videos = getVideos();
  if(!videos.length) return;
  videos[0].likes = (videos[0].likes||0)+1;
  setVideos(videos);
  document.getElementById('heroLikes').innerText = videos[0].likes;
}

/* Upload handling */
function handleUpload(){
  const file = document.getElementById('fileInput')?.files?.[0];
  const url = (document.getElementById('urlInput')?.value || '').trim();
  const title = (document.getElementById('titleInput')?.value || '').trim() || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      const videos = getVideos();
      const id = Date.now();
      videos.unshift({id:id, title:title, user:localUsername(), src:e.target.result, likes:0, created:Date.now()});
      setVideos(videos);
      alert('ØªÙ… Ø§Ù„Ø±ÙØ¹ Ù…Ø­Ù„ÙŠØ§Ù‹');
      go('#home');
    };
    reader.readAsDataURL(file);
    return;
  }
  if(url){
    const videos = getVideos();
    const id = Date.now();
    videos.unshift({id:id, title:title, user:localUsername(), src:url, likes:0, created:Date.now()});
    setVideos(videos);
    alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø·');
    go('#home');
    return;
  }
  alert('Ø§Ø®ØªØ§Ø± Ù…Ù„Ù Ø£Ùˆ Ø±Ø§Ø¨Ø·');
}

/* Profile render */
function currentUser(){
  // for prototype, user stored in LS_USERS[0] or a simple "you"
  const users = ensure(LS_USERS);
  // make sure there is a 'you' user
  let u = users.find(x=>x.username==='you');
  if(!u){ u = {id:'you', username:'you', display:'Ø£Ù†Øª', coins:0}; users.push(u); save(LS_USERS, users); }
  return u;
}
function localUsername(){ return currentUser().username; }
function renderProfileGrid(){
  const all = getVideos();
  const mine = all.filter(v=>v.user===localUsername());
  const grid = document.getElementById('myGrid');
  grid.innerHTML='';
  mine.forEach(v=>{
    const d = document.createElement('div'); d.className='cell';
    d.innerHTML = `<div style="font-weight:800">${v.title}</div><div style="margin-top:8px"><button class="btn" onclick="openVideoInHero('${escapeJs(v.src)}')">Ø¹Ø±Ø¶</button></div>`;
    grid.appendChild(d);
  });
  document.getElementById('myCoins')?.innerText = currentUser().coins || 0;
}
function openVideoInHero(src){
  // insert as data at top
  const videos = getVideos();
  const id = Date.now();
  videos.unshift({id:id, title:'Ù…Ù† Ø¨Ø±ÙˆÙØ§ÙŠÙ„ÙŠ', user:localUsername(), src:src, likes:0, created:Date.now()});
  setVideos(videos);
  renderFeed();
  go('#home');
}

/* Admin functions */
function showAdminTab(t){
  document.getElementById('adminOverview').style.display = (t==='overview')?'block':'none';
  document.getElementById('adminVideos').style.display = (t==='videos')?'block':'none';
  document.getElementById('adminUsers').style.display = (t==='users')?'block':'none';
  document.getElementById('adminPayments').style.display = (t==='payments')?'block':'none';
  // active item highlight
  document.querySelectorAll('.aside .item').forEach(it=>{ it.classList.remove('active'); if(it.textContent.includes(t==='overview'?'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©': t==='videos'?'Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª': t==='users'?'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†':'Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª')) it.classList.add('active'); })
}
function renderAdminOverview(){
  const videos = getVideos();
  const payments = ensure(LS_PAYMENTS);
  document.getElementById('countVideos').innerText = videos.length;
  document.getElementById('countPayments').innerText = payments.length;
}
function renderAdminVideos(){
  const videos = getVideos();
  const tbody = document.getElementById('videosTableBody'); tbody.innerHTML='';
  videos.forEach(v=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${v.user}</td><td>${v.title}</td><td><button class="btn ghost" onclick="adminDeleteVideo(${v.id})">Ø­Ø°Ù</button></td>`;
    tbody.appendChild(tr);
  });
}
function adminDeleteVideo(id){
  if(!confirm('ØªØ£ÙƒØ¯ Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ')) return;
  let videos = getVideos(); videos = videos.filter(x=>x.id!==id); setVideos(videos);
  renderAdminOverview(); renderAdminVideos(); alert('ØªÙ… Ø§Ù„Ø­Ø°Ù');
}
function renderAdminUsers(){
  const users = ensure(LS_USERS);
  const tbody = document.getElementById('usersTableBody'); tbody.innerHTML='';
  users.forEach(u=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>@${u.username}</td><td>${u.coins||0}</td><td><button class="btn ghost" onclick="adminAdjustCoins('${u.username}')">ØªØ¹Ø¯ÙŠÙ„</button></td>`;
    tbody.appendChild(tr);
  });
}
function adminAdjustCoins(username){
  const amount = parseInt(prompt('ÙƒÙ… ØªØ±ÙŠØ¯ ØªØ¶ÙŠÙ/ØªÙ†Ù‚Øµ (Ù…Ø«Ø§Ù„ +100 Ø£Ùˆ -50) Ù„Ù„Ù€ '+username,'+100'));
  if(isNaN(amount)) return alert('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
  const users = ensure(LS_USERS);
  const u = users.find(x=>x.username===username);
  if(!u) return;
  u.coins = (u.coins||0)+amount;
  save(LS_USERS, users);
  renderAdminUsers();
  alert('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
}

/* Payments handling - manual BaridiMob flow */
function createPayment(){
  const amount = parseInt(document.getElementById('payAmount')?.value || 0);
  const note = document.getElementById('payNote')?.value || '';
  const file = document.getElementById('payReceipt')?.files?.[0];
  if(!amount || amount<=0) return alert('Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ§Ù„Ø­');
  if(!file) return alert('Ø­Ø· ØµÙˆØ±Ø© Ø§Ù„ÙˆØµÙ„');
  const reader = new FileReader();
  reader.onload = function(e){
    const payments = ensure(LS_PAYMENTS);
    const id = Date.now();
    const me = currentUser();
    payments.unshift({id:id, user:me.username, amount:amount, note:note, receipt:e.target.result, status:'pending', created:Date.now()});
    save(LS_PAYMENTS,payments);
    alert('ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ â€” Admin Ø±Ø­ ÙŠØ±Ø§Ø¬Ø¹Ù‡');
    go('#home');
  };
  reader.readAsDataURL(file);
}
function renderAdminPayments(){
  const payments = ensure(LS_PAYMENTS);
  const el = document.getElementById('paymentsList'); el.innerHTML='';
  if(!payments.length) el.innerHTML = '<div class="small">Ù…Ø§ÙƒØ§Ù† Ø­ØªÙ‰ Ø·Ù„Ø¨</div>';
  payments.forEach(p=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML = `<div style="flex:1;text-align:right"><div style="font-weight:900">${p.user}</div><div class="small">Ø§Ù„Ù…Ø¨Ù„Øº: ${p.amount} Ø¯Ø¬ â€” Ø§Ù„Ø­Ø§Ù„Ø©: ${p.status}</div><div style="margin-top:8px">${p.note||''}</div></div>
      <div style="width:120px"><img src="${p.receipt}" style="width:100%;border-radius:8px"></div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-right:12px">
        ${p.status==='pending'?'<button class="btn" onclick="adminConfirmPayment('+p.id+')">Ù‚Ø¨ÙˆÙ„</button><button class="btn ghost" onclick="adminRejectPayment('+p.id+')">Ø±ÙØ¶</button>':''}
      </div>`;
    el.appendChild(d);
  });
}
function adminConfirmPayment(id){
  if(!confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ØŸ')) return;
  const payments = ensure(LS_PAYMENTS);
  const p = payments.find(x=>x.id===id);
  if(!p) return;
  p.status='confirmed';
  save(LS_PAYMENTS,payments);
  // grant coins as example: 100 coins per 1000 DZD
  const users = ensure(LS_USERS);
  let u = users.find(x=>x.username===p.user);
  if(!u){ u = {id:p.user, username:p.user, display:p.user, coins:0}; users.push(u); }
  const coins = Math.round(p.amount/10); // simple rate: 1 coin = 10 DZD
  u.coins = (u.coins||0) + coins;
  save(LS_USERS, users);
  renderAdminPayments(); renderAdminUsers(); alert('ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ø¨ÙØ­ ' + coins + ' coins');
}
function adminRejectPayment(id){
  if(!confirm('Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
  const payments = ensure(LS_PAYMENTS);
  const idx = payments.findIndex(x=>x.id===id);
  if(idx===-1) return;
  payments[idx].status='rejected';
  save(LS_PAYMENTS,payments);
  renderAdminPayments();
  alert('ØªÙ… Ø§Ù„Ø±ÙØ¶');
}

/* Settings: save baridi number */
function saveBaridi(){
  const settings = ensure(LS_SETTINGS);
  const v = document.getElementById('baridiNumberInput').value.trim();
  settings.baridiNumber = v;
  save(LS_SETTINGS, settings);
  alert('ØªÙ… Ø­ÙØ¸ BaridiMob');
}

/* Admin login (simple local) */
function logoutAdmin(){ localStorage.setItem('alg_admin_logged','false'); alert('ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬'); go('#home'); }
function adminLoginFlow(){
  const settings = ensure(LS_SETTINGS);
  const username = prompt('Ø§Ø³Ù… Ø§Ù„Ø§Ø¯Ù…Ù†','admin');
  const pass = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±','admin123');
  if(username===settings.adminUser && pass===settings.adminPass){
    localStorage.setItem('alg_admin_logged','true');
    alert('Ù…Ø±Ø­Ø¨Ø§ Admin');
    go('#admin');
  } else {
    alert('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø®Ø§Ø·Ø¦Ø©');
    go('#home');
  }
}

/* security: only show admin if logged-in or ask login */
function beforeRenderAdmin(){
  const logged = localStorage.getItem('alg_admin_logged') === 'true';
  if(!logged){
    adminLoginFlow();
    return false;
  }
  return true;
}

/* helpers */
function escapeJs(s){ return s.replace(/'/g,"\\'").replace(/"/g,'\\"'); }

/* ========== Small page mount actions ========== */
function hydrateAdminGate(){
  if(!beforeRenderAdmin()) return;
  renderAdminOverview(); renderAdminVideos(); renderAdminUsers(); renderAdminPayments();
}

/* ========== Page rendering guard ========== */
function renderRoute(){
  const root = document.getElementById('view-root');
  const h = location.hash.replace('#','') || 'home';
  if(h==='admin'){
    // admin protected
    const can = beforeRenderAdmin();
    if(!can) return;
    root.innerHTML = AdminHTML();
  } else if(h==='home') root.innerHTML = HomeHTML();
  else if(h==='upload') root.innerHTML = UploadHTML();
  else if(h==='profile') root.innerHTML = ProfileHTML();
  else if(h==='payments') root.innerHTML = PaymentsHTML();
  else root.innerHTML = HomeHTML();
  setTimeout(hydrate,50);
}

/* ========== share and small utilities ========== */
function shareCurrent(){
  const videos = getVideos();
  if(!videos.length) return alert('Ù…Ø§ÙƒØ§Ù†Ø´ ÙÙŠØ¯ÙŠÙˆ');
  const url = videos[0].src;
  if(navigator.share){
    navigator.share({title:videos[0].title,text:'Ø´ÙˆÙ Ù‡Ø§Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ',url:url}).catch(()=>{});
  } else {
    prompt('Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ´Ø§Ø±ÙƒÙˆ', url);
  }
}

/* ========== Admin quick controls for demo: auto-login if default creds set ========== */
(function autoOpen(){
  // if admin logged flag exists true keep it
  if(localStorage.getItem('alg_admin_logged')==='true'){}
})();

/* start */
window.addEventListener('load', onLoad);
</script>

<!-- ====== End of app ====== -->
</body>
</html>
