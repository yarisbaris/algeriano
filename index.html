<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Algeriano â€” TikTok Style (Prototype)</title>
<style>
:root{
  --bg:#08090b; --card:#0d1114; --muted:#98a0ad;
  --primary:#00c78a; --accent:#6a00ff; --glass: rgba(255,255,255,0.03);
  font-family: "Tajawal", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:#fff;overflow:hidden}
.header{height:56px;display:flex;align-items:center;justify-content:space-between;padding:8px 14px;border-bottom:1px solid rgba(255,255,255,0.03)}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:40px;height:40;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:#000;font-weight:900}
.title{font-weight:800}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:10px;color:var(--primary);cursor:pointer;font-weight:800}
.btn.primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:#000;border:none}
.container{position:absolute;top:56px;bottom:0;left:0;right:0;overflow-y:scroll;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch}
.feed-item{position:relative;height:100vh;scroll-snap-align:start;display:flex;align-items:center;justify-content:center;background:#000}
video.feed-video{width:100%;height:100%;object-fit:cover}
.meta-panel{position:absolute;left:12px;bottom:28px;right:80px;display:flex;flex-direction:column;gap:6px}
.meta-panel .user{font-weight:900}
.side-controls{position:absolute;right:10px;bottom:100px;display:flex;flex-direction:column;gap:12px;align-items:center}
.icon{width:56px;height:56px;border-radius:12px;background:var(--glass);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
.icon .count{display:block;font-size:12px;margin-top:6px;color:var(--muted)}
.top-actions{display:flex;gap:8px;align-items:center}
.search{padding:6px 10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;padding:20px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);max-width:720px;width:100%}
.form-row{display:flex;gap:8px;align-items:center}
.input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#fff}
.small{font-size:13px;color:var(--muted)}
.profile-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px}
.thumb{background:#071018;border-radius:8px;height:84px;display:flex;align-items:center;justify-content:center;color:#888}
.footer{position:fixed;left:0;right:0;bottom:0;height:56px;background:linear-gradient(90deg, rgba(0,0,0,0.6), transparent);display:flex;align-items:center;justify-content:center}
.note{font-size:12px;color:var(--muted);text-align:center;padding:8px}

/* responsive tweaks */
@media(max-width:600px){
  .meta-panel{left:10px;right:70px}
  .icon{width:48px;height:48}
}
</style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="logo">A</div>
    <div>
      <div class="title">Algeriano</div>
      <div class="small">Ù…Ù†ØµØ© ÙÙŠØ¯ÙŠÙˆ â€” Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</div>
    </div>
  </div>
  <div class="controls">
    <input id="search" class="search" placeholder="Ø¯ÙˆØ± Ø¹Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ ÙŠÙˆØ²Ø±">
    <button class="btn" id="btnRandom">Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
    <button class="btn primary" id="btnUpload">Ø±ÙØ¹</button>
    <button class="btn" id="btnProfile">Ø¨Ø±ÙˆÙØ§ÙŠÙ„ÙŠ</button>
  </div>
</header>

<main class="container" id="feed"></main>

<div class="footer">
  <div class="note">Algeriano â€” Prototype</div>
</div>

<!-- Overlays -->
<div id="overlay" class="overlay">
  <div class="card" id="overlayCard"></div>
</div>

<script>
/* -------------------------
  Algeriano â€” Single file app
  - storage: localStorage (videos, users, comments, likes)
  - features: feed, upload, profile, like, comments, simple algo
--------------------------*/

/* Keys */
const LS_VIDEOS = 'alg_videos_v4';
const LS_USERS = 'alg_users_v4';
const LS_COMMENTS = 'alg_comments_v4';
const LS_LIKES = 'alg_likes_v4';
const LS_CURRENT = 'alg_current_v4';

/* Helpers */
function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
function load(key){ return JSON.parse(localStorage.getItem(key) || 'null'); }
function ensure(key, init){ if(!localStorage.getItem(key)) save(key, init); return load(key); }

/* Init sample */
function init(){
  ensure(LS_USERS, [{id:'you', username:'you', display:'Ø£Ù†Øª', coins:0}]);
  ensure(LS_COMMENTS, []);
  ensure(LS_LIKES, {});
  if(!localStorage.getItem(LS_VIDEOS)){
    save(LS_VIDEOS, [
      {id:1, user:'algeriano', title:'ØªØ¬Ø±ÙŠØ¨ÙŠ â€” Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', src:'https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4', likes:120, created:Date.now()-300000},
      {id:2, user:'sara_dz', title:'Ø²Ù‡Ø±Ø©', src:'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4', likes:88, created:Date.now()-200000},
      {id:3, user:'yassine', title:'Ù‚ØµÙŠØ±', src:'https://samplelib.com/lib/preview/mp4/sample-5s.mp4', likes:45, created:Date.now()-100000}
    ]);
  }
  ensure(LS_CURRENT, {username:'you'});
}
init();

/* Utilities */
function q(sel){ return document.querySelector(sel); }
function qAll(sel){ return Array.from(document.querySelectorAll(sel)); }
function uid(){ return Date.now() + Math.floor(Math.random()*999); }

/* Feed rendering */
function renderFeed(order='latest', filter=''){
  const feed = q('#feed'); feed.innerHTML='';
  let videos = ensure(LS_VIDEOS);
  // algorithm
  if(order==='latest') videos = videos.sort((a,b)=>b.created - a.created);
  else if(order==='random') videos = videos.sort(()=>Math.random()-0.5);
  if(filter) videos = videos.filter(v=> v.title.includes(filter) || v.user.includes(filter));

  videos.forEach(v=>{
    const el = document.createElement('section'); el.className='feed-item';
    el.innerHTML = `
      <video class="feed-video" src="${v.src}" playsinline muted></video>
      <div class="meta-panel">
        <div class="user">@${v.user} â€¢ <span class="small">${v.title}</span></div>
      </div>
      <div class="side-controls">
        <div class="icon" data-id="${v.id}" onclick="toggleLike(event)">
          â¤ <span class="count" id="like-count-${v.id}">${v.likes||0}</span>
        </div>
        <div class="icon" onclick="openComments(${v.id})">ğŸ’¬</div>
        <div class="icon" onclick="shareVideo('${encodeURIComponent(v.src)}')">ğŸ”—</div>
      </div>`;
    feed.appendChild(el);
  });

  // autoplay visible video
  setTimeout(()=>{ attachVideoObservers(); },50);
}

/* IntersectionObserver autoplay */
let io;
function attachVideoObservers(){
  const vids = qAll('video.feed-video');
  if(io) io.disconnect();
  io = new IntersectionObserver(entries=>{
    entries.forEach(en=>{
      const v = en.target;
      if(en.isIntersecting && en.intersectionRatio>0.6){ v.muted=false; v.play().catch(()=>{}); }
      else v.pause();
    });
  }, {threshold:[0.6]});
  vids.forEach(v=> io.observe(v));
}

/* Like handling */
function toggleLike(e){
  const id = parseInt(e.currentTarget.dataset.id);
  const likes = ensure(LS_LIKES);
  const current = ensure(LS_CURRENT);
  const key = `${current.username}_${id}`;
  if(likes[key]){ // unlike
    delete likes[key];
    updateLikesCount(id, -1);
  } else {
    likes[key]=true;
    updateLikesCount(id, +1);
  }
  save(LS_LIKES, likes);
  renderLikeUI(id);
}
function updateLikesCount(id, delta){
  const vids = ensure(LS_VIDEOS);
  const v = vids.find(x=>x.id===id);
  if(v){ v.likes = (v.likes||0) + delta; save(LS_VIDEOS, vids); document.getElementById('like-count-'+id).innerText = v.likes; }
}
function renderLikeUI(id){
  const likes = ensure(LS_LIKES);
  const current = ensure(LS_CURRENT);
  const key = `${current.username}_${id}`;
  const el = document.querySelector(`[data-id="${id}"]`);
  if(el) el.style.background = likes[key] ? 'linear-gradient(90deg,var(--primary),var(--accent))' : '';
}

/* Comments overlay */
function openComments(id){
  const comments = ensure(LS_COMMENTS).filter(c=>c.videoId===id);
  showOverlay(`<h3>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
    <div style="max-height:40vh;overflow:auto;margin:8px 0">${comments.map(c=>`<div style="padding:6px;border-bottom:1px solid rgba(255,255,255,0.03)"><strong>@${c.user}</strong><div class="small">${c.text}</div></div>`).join('') || '<div class="small">Ù„Ø§ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯</div>'}</div>
    <div class="form-row"><input id="commentText" class="input" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚"><button class="btn primary" onclick="postComment(${id})">Ù†Ø´Ø±</button></div>
  `);
}
function postComment(id){
  const txt = q('#commentText').value.trim();
  if(!txt) return alert('Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚');
  const comments = ensure(LS_COMMENTS);
  const current = ensure(LS_CURRENT);
  comments.unshift({id:uid(), videoId:id, user:current.username, text:txt, created:Date.now()});
  save(LS_COMMENTS, comments);
  closeOverlay();
  alert('ØªÙ… Ø§Ù„Ù†Ø´Ø±');
}

/* Share */
function shareVideo(srcEnc){
  const src = decodeURIComponent(srcEnc);
  if(navigator.share){ navigator.share({title:'Ø´ÙˆÙ Ù‡Ø§Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', url:src}).catch(()=>{}); }
  else prompt('Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ´Ø§Ø±ÙƒÙ‡', src);
}

/* Overlay helpers */
function showOverlay(html){
  const ov = q('#overlay'); const card = q('#overlayCard');
  card.innerHTML = html + `<div style="text-align:left;margin-top:10px"><button class="btn" onclick="closeOverlay()">Ø¥ØºÙ„Ø§Ù‚</button></div>`;
  ov.style.display = 'flex';
}
function closeOverlay(){ q('#overlay').style.display='none'; q('#overlayCard').innerHTML=''; }

/* Upload */
q('#btnUpload').addEventListener('click', ()=> openUpload());
function openUpload(){
  showOverlay(`<h3>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</h3>
    <div class="form-row"><input id="upFile" type="file" accept="video/*" class="input"></div>
    <div style="margin-top:8px"><input id="upUrl" placeholder="Ø£Ùˆ Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· mp4" class="input"></div>
    <div style="margin-top:8px"><input id="upTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ" class="input"></div>
    <div style="margin-top:8px"><button class="btn primary" onclick="doUpload()">Ø±ÙØ¹</button></div>
    <div class="small" style="margin-top:8px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¹Ù„Ù‰ localStorage Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯</div>
  `);
}
function doUpload(){
  const f = q('#upFile')?.files?.[0];
  const url = q('#upUrl')?.value.trim();
  const title = q('#upTitle')?.value.trim() || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
  if(f){
    const r = new FileReader();
    r.onload = function(e){
      addVideo({src:e.target.result, title});
      closeOverlay(); alert('ØªÙ… Ø§Ù„Ø±ÙØ¹ (Ù…Ø­Ù„ÙŠ)');
    };
    r.readAsDataURL(f);
    return;
  }
  if(url){
    addVideo({src:url, title}); closeOverlay(); alert('ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©'); return;
  }
  alert('Ø§Ø®ØªØ§Ø± Ù…Ù„Ù Ø£Ùˆ Ø±Ø§Ø¨Ø·');
}
function addVideo({src, title}){
  const videos = ensure(LS_VIDEOS);
  const id = uid();
  videos.unshift({id:id, user: ensure(LS_CURRENT).username || 'you', title:title, src:src, likes:0, created:Date.now()});
  save(LS_VIDEOS, videos);
  renderFeed();
}

/* Profile */
q('#btnProfile').addEventListener('click', ()=> openProfile());
function openProfile(){
  const current = ensure(LS_CURRENT);
  showOverlay(`<h3>Ø¨Ø±ÙˆÙØ§ÙŠÙ„ÙŠ â€” @${current.username}</h3>
    <div class="small">Coins: ${current.coins||0}</div>
    <div style="margin-top:8px"><button class="btn" onclick="logout()">Ø®Ø±ÙˆØ¬</button></div>
    <h4 style="margin-top:12px">ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªÙŠ</h4>
    <div class="profile-grid">${ensure(LS_VIDEOS).filter(v=>v.user===current.username).map(v=>`<div class="thumb" onclick="openVideoFromThumb('${encodeURIComponent(v.src)}')">${v.title}</div>`).join('') || '<div class="small">Ù„Ø§ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</div>'}</div>
  `);
}
function openVideoFromThumb(srcEnc){
  const src = decodeURIComponent(srcEnc);
  // place it to top
  const videos = ensure(LS_VIDEOS);
  const v = videos.find(x=>x.src===src);
  if(v){
    // move to top
    const idx = videos.indexOf(v); videos.splice(idx,1); videos.unshift(v); save(LS_VIDEOS, videos); renderFeed();
    closeOverlay();
    // scroll top
    q('.container').scrollTo({top:0,behavior:'smooth'});
  }
}
function logout(){ if(confirm('ØªØ±ÙŠØ¯ ØªØ®Ø±Ø¬ØŸ')){ save(LS_CURRENT, {username:'guest'}); closeOverlay(); alert('ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬'); }}

/* Search */
q('#search').addEventListener('input', (e)=> {
  const v = e.target.value.trim();
  if(v.length>0) renderFeed('latest', v);
  else renderFeed('latest','');
});

/* Random */
q('#btnRandom').addEventListener('click', ()=> { renderFeed('random',''); q('#feed').scrollTo({top:0,behavior:'smooth'}); });

/* Admin quick â€” double-tap header to admin login (simple) */
q('.header').addEventListener('dblclick', ()=>{
  const username = prompt('Ø§Ø³Ù… Ø§Ù„Ø§Ø¯Ù…Ù†','admin'); const pass = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±','admin123');
  // for prototype accept admin/admin123
  if(username==='admin' && pass==='admin123'){ showOverlay(`<h3>Ù„ÙˆØ­Ø© Admin (ØªØ¬Ø±ÙŠØ¨)</h3>
    <div class="small">Ø¹Ø¯Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª: ${ensure(LS_VIDEOS).length}</div>
    <div style="margin-top:8px"><button class="btn" onclick="clearVideos()">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</button></div>
    <div style="margin-top:8px"><button class="btn" onclick="exportData()">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button></div>
    <div style="margin-top:8px"><button class="btn ghost" onclick="closeOverlay()">Ø¥ØºÙ„Ø§Ù‚</button></div>
  `); } else alert('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø®Ø§Ø·Ø¦Ø©');
});
function clearVideos(){ if(confirm('ØªØ£ÙƒÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªØŸ')){ save(LS_VIDEOS, []); renderFeed(); alert('ØªÙ… Ø§Ù„Ù…Ø³Ø­'); closeOverlay(); } }
function exportData(){ const data = {videos:ensure(LS_VIDEOS),comments:ensure(LS_COMMENTS),likes:ensure(LS_LIKES)}; const s = JSON.stringify(data); const blob = new Blob([s],{type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='algeriano_data.json'; a.click(); }

/* initial render */
renderFeed();
</script>

</body>
</html>
